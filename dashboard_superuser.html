<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>Dashboard — สายตรวจ / ผู้จัดการโซน</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body { background:#f6f7f9; }
    .app-wrap { max-width: 1060px; }
    .card-soft { border: 0; border-radius: 18px; }
    .navbtn{
      min-height:40px;
      padding:.35rem .75rem;
      border-radius:12px;
      white-space:nowrap;
    }
    .touch-lg{ min-height:48px; }
    .kpi-badge{ font-size:.85rem; }
    .legend .badge{ min-width: 92px; }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-success">
    <div class="container-fluid d-flex align-items-center gap-2">
      <span class="navbar-brand mb-0 fw-semibold">ระบบปฏิบัติงาน รปภ.</span>

      <div class="d-flex align-items-center gap-2 ms-auto">
        <span class="badge text-bg-light text-dark d-none d-md-inline kpi-badge">
          SUPERUSER / MANAGER
        </span>
        <button class="btn btn-outline-light btn-sm navbtn" onclick="logout()">
          ออกจากระบบ
        </button>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="container py-4">
    <div class="mx-auto app-wrap">
      <div class="d-flex flex-wrap align-items-end justify-content-between gap-2 mb-3">
        <div>
          <h1 class="h4 mb-1 fw-semibold">แดชบอร์ด สายตรวจ / ผู้จัดการโซน</h1>
          <div class="text-muted small">
            ภาพรวมกำลังพล / สถานะไซต์ / เข้า–ออกเวร (ตามสิทธิ์)
          </div>
        </div>
      </div>

      <!-- Welcome / Scope -->
      <div class="card shadow-sm card-soft mb-3">
        <div class="card-body p-4">
          <div class="d-flex flex-wrap align-items-start justify-content-between gap-3">
            <div>
              <div class="mb-1">
                ยินดีต้อนรับคุณ <strong><span id="displayName">-</span></strong>
              </div>
              <div class="small text-muted">
                โซนที่รับผิดชอบหลัก: <span class="fw-semibold" id="zoneName">-</span>
              </div>
              <div class="small text-muted mt-1" id="zoneScopeInfo">
                <!-- JS เติมข้อความเพิ่มเติมสำหรับ multi-zone -->
              </div>
            </div>

            <div class="d-flex align-items-center gap-2">
              <span class="badge text-bg-success kpi-badge">พร้อมปฏิบัติการ</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Action -->
      <div class="card shadow-sm card-soft mb-4">
        <div class="card-body p-4">
          <div class="d-flex align-items-start justify-content-between gap-3 mb-2">
            <div>
              <div class="fw-semibold mb-1">โหมดปฏิบัติการ</div>
              <div class="small text-muted">
                ปุ่มด้านล่างจะพาไปหน้าเข้า/ออกเวร และกลับมาหน้านี้อัตโนมัติ
              </div>
            </div>
            <span class="badge text-bg-light border text-dark kpi-badge d-none d-md-inline">
              Return: dashboard_superuser.html
            </span>
          </div>

          <div class="row g-2 mt-1">
            <div class="col-12 col-md-6">
              <a
                id="btnClockIn"
                href="time_clockin.html?return=dashboard_superuser.html"
                class="btn btn-success w-100 touch-lg fw-semibold"
              >
                ✅ เข้าเวร (ลงเวลาเข้า)
              </a>
            </div>

            <div class="col-12 col-md-6">
              <a
                id="btnClockOut"
                href="time_clockout.html?return=dashboard_superuser.html"
                class="btn btn-outline-danger w-100 touch-lg fw-semibold disabled"
                aria-disabled="true"
              >
                ⛔ ออกเวร (ลงเวลาออก)
              </a>
            </div>
          </div>

          <div id="dutyHint" class="small text-muted mt-2"></div>

          <div class="small text-muted mt-2">
            * ระบบจะระบุหน่วยงานจากตำแหน่ง GPS อัตโนมัติ
          </div>
        </div>
      </div>

      <!-- Zone Overview -->
      <section id="zoneOverviewSection">
        <div class="d-flex flex-wrap align-items-end justify-content-between gap-2 mb-2">
          <div>
            <h5 class="mb-1 fw-semibold">ภาพรวมไซต์ในโซนของคุณ</h5>
            <div class="text-muted small">เลือกวันที่แล้วกด “โหลดข้อมูล” เพื่อดูสถานะรายไซต์</div>
          </div>
        </div>

        <!-- Zone filter (multi-zone) -->
        <div id="zoneFilterContainer" class="mb-3 d-none">
          <div class="card shadow-sm card-soft">
            <div class="card-body py-3 px-4">
              <div class="d-flex flex-wrap align-items-center gap-2">
                <label for="zoneFilter" class="small fw-semibold mb-0">
                  เลือกโซนที่ต้องการดู:
                </label>
                <select id="zoneFilter" class="form-select form-select-sm" style="max-width: 240px">
                  <option value="ALL">ทุกโซนที่มีสิทธิ์</option>
                </select>
                <span class="small text-muted">
                  * สำหรับผู้ที่มีสิทธิ์ดูมากกว่า 1 โซน
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Legend -->
        <div class="card shadow-sm card-soft mb-3 legend">
          <div class="card-body py-3 px-4">
            <div class="small fw-bold mb-2">คำอธิบายสถานะไซต์</div>

            <div class="row g-2 small">
              <div class="col-12 col-md-6">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge bg-secondary">ไม่มีเวร</span>
                  <span class="text-muted">NO_DUTY — วันนี้ไม่มีการจัดเวร</span>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge bg-info text-dark">ยังไม่เริ่ม</span>
                  <span class="text-muted">NOT_STARTED — ยังไม่มีใครลงเวลาเข้า</span>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge bg-warning text-dark">ยังเข้าไม่ครบ</span>
                  <span class="text-muted">IN_PROGRESS_NOT_FULL — มาแล้วแต่ยังไม่ครบตามแผน</span>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge bg-success">ปกติ</span>
                  <span class="text-muted">FULL_OK — คนครบตามแผน และไม่มีปัญหา</span>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge bg-warning text-dark">เฝ้าระวัง</span>
                  <span class="text-muted">FULL_ISSUES — คนครบแต่มีประเด็น (สาย/ออกก่อน/GPS/ยังไม่ออก)</span>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge bg-danger">ขาดเวร</span>
                  <span class="text-muted">UNDER_STAFFED — เลยเวลาควรเข้าเวรแล้วแต่คนยังไม่ครบ</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Date + Load -->
        <div class="card shadow-sm card-soft mb-3">
          <div class="card-body py-3 px-4">
            <div class="d-flex flex-wrap align-items-center gap-2">
              <div class="me-2 small fw-semibold text-muted">เลือกวันที่:</div>
              <input type="date" id="dateInput" class="form-control" style="max-width: 190px" />
              <button class="btn btn-primary touch-lg px-4 fw-semibold" id="loadBtn">
                โหลดข้อมูล
              </button>
              <div class="small text-muted ms-auto">
                เคล็ดลับ: ถ้าดูย้อนหลัง ระบบจะแสดงรวม D+N
              </div>
            </div>
          </div>
        </div>

        <!-- Results -->
        <div id="zoneSitesContainer" class="mt-2"></div>
      </section>

      <hr class="my-4" />

      <!-- Reports (future) -->
      <section>
        <h5 class="mb-2 fw-semibold">รายงานเหตุจากหน่วย (ยังไม่เปิดใช้งาน)</h5>
        <p class="text-muted mb-0">
          ส่วนนี้จะเปิดในเฟสถัดไป เพื่อให้สายตรวจดูรายงานประจำวันและรูปภาพประกอบ
        </p>
      </section>
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- API (ต้องโหลดก่อนทุกไฟล์อื่น) -->
  <script src="js/api.js"></script>

  <!-- Auth JS -->
  <script src="js/auth.js"></script>

  <!-- Dashboard Superuser Logic -->
  <script src="js/dashboard_superuser.js"></script>
</body>
</html>
